<project>
	<property name="dir.ext.jar" location="../Common/jar" />
	<property name="dir.src" location="src" />

	<property name="dir.build" location="tmp/build" />
	<property name="dir.build.bin" location="${dir.build}/bin" />
	<property name="dir.build.jar" location="${dir.build}/jar" />

	<property name="dir.web" location="./web" />

	<property name="catalina.base" location="/var/lib/tomcat7" />
	<property name="catalina.home" location="/usr/share/tomcat7" />

	<path id="ext.jar">
		<fileset dir="${dir.ext.jar}">
			<include name="*.jar" />
		</fileset>
		<fileset dir="${catalina.home}/lib" >
			<include name="servlet-api.jar" />
		</fileset>
	</path>

	<property name="jar.yokwe" location="${dir.build.jar}/yokwe.jar" />

	<target name="deploy">
                <!-- delete war file -->
		<delete file="${dir.build}/securities.war" quiet="true" />
                <!-- create war file -->
		<war destfile="${dir.build}/securities.war" webxml="${dir.web}/WEB-INF/web.xml">
			<lib file="${jar.yokwe}" />
			<lib dir="${dir.ext.jar}">
				<include name="*.jar" />
			</lib>
			<classes dir="${dir.web}/WEB-INF/classes" />
			<fileset dir="${dir.web}">
                                <exclude name="WEB-INF/**" />
			</fileset>
		</war>

		<!-- webapps directory has auto deploy feature (default on) -->
		<!-- Use this feature to deploy securities.war -->
		<!-- So deploing war file in tomcat is just copy war file to ${catalina.base}/webapps -->
		<copy file="${dir.build}/securities.war" todir="${catalina.base}/webapps" />
	</target>

	<target name="clean">
		<delete includeemptydirs="true" quiet="true">
			<fileset dir="${dir.build}" includes="**/*" />
		</delete>
	</target>

	<target name="build">
		<!-- clean destination directories -->
		<delete dir="${dir.build.bin}" quiet="true" />
		<mkdir dir="${dir.build.bin}" />
		<delete dir="${dir.build.jar}" quiet="true" />
		<mkdir dir="${dir.build.jar}" />
		<!-- compile -->
		<javac srcdir="${dir.src}" destdir="${dir.build.bin}" classpathref="ext.jar" includeAntRuntime="false"
		        debug="true" debuglevel="lines,vars,source"/>
		<!-- copy resource file -->
		<copy todir="${dir.build.bin}">
			<fileset dir="${dir.src}" excludes="**/*.java" />
		</copy>
		<!-- make jar -->
		<jar destfile="${jar.yokwe}" basedir="${dir.build.bin}" />
	</target>
	

	<target name="run-fetch">
		<java classname="yokwe.finance.securities.app.Fetch" fork="true">
			<classpath location="${jar.yokwe}" />
			<classpath refid="ext.jar" />
                        <sysproperty key="waitPeriod" value="100"/>
			<arg value="tmp/fetch.list"/>
		</java>
	</target>

        <target name="run-update-nasdaq">
                <java classname="yokwe.finance.securities.update.Nasdaq" fork="true">
                        <classpath location="${jar.yokwe}" />
                        <classpath refid="ext.jar" />
                        <arg value="tmp/fetch/nasdaq/nasdaqtraded.txt"/>
                        <arg value="tmp/database/nasdaq.csv"/>
                </java>
        </target>

        <target name="run-update-yahoo-dividend">
                <java classname="yokwe.finance.securities.update.YahooDividend" fork="true">
                        <classpath location="${jar.yokwe}" />
                        <classpath refid="ext.jar" />
                        <arg value="tmp/fetch/yahoo-dividend"/>
                        <arg value="tmp/database/yahoo-dividend-update.csv"/>
                </java>
        </target>
	
        <target name="run-update-google-getprices">
                <java classname="yokwe.finance.securities.update.GoogleGetPrices" fork="true">
                        <classpath location="${jar.yokwe}" />
                        <classpath refid="ext.jar" />
                        <arg value="tmp/fetch/google-getprices"/>
                        <arg value="tmp/database/google-getprices-update.csv"/>
                </java>
        </target>



        <target name="run-update-yahoo-daily">
                <java classname="yokwe.finance.securities.update.YahooDaily" fork="true">
                        <classpath location="${jar.yokwe}" />
                        <classpath refid="ext.jar" />
                        <arg value="tmp/fetch/yahoo-daily"/>
                        <arg value="tmp/database/yahoo-daily.csv"/>
                </java>
        </target>

	<target name="run-update-yahoo-finance">
		<java classname="yokwe.finance.securities.update.YahooFinance" fork="true">
			<classpath location="${jar.yokwe}" />
			<classpath refid="ext.jar" />
			<arg value="tmp/fetch/yahoo-finance"/>
			<arg value="tmp/database/yahoo-finance.csv"/>
		</java>
	</target>

	<target name="run-update-nasdaq-symbol">
		<java classname="yokwe.finance.securities.update.NasdaqSymbol" fork="true">
			<classpath location="${jar.yokwe}" />
			<classpath refid="ext.jar" />
			<arg value="tmp/fetch/nasdaq-symbol"/>
			<arg value="tmp/database/nasdaq-symbol.csv"/>
		</java>
	</target>

	<target name="run-update-nasdaq-dividend">
		<java classname="yokwe.finance.securities.update.NasdaqDividend" fork="true">
			<classpath location="${jar.yokwe}" />
			<classpath refid="ext.jar" />
			<arg value="tmp/fetch/nasdaq-dividend"/>
			<arg value="tmp/database/nasdaq-dividend.csv"/>
		</java>
	</target>

	<target name="run-update-google-historical">
		<java classname="yokwe.finance.securities.update.GoogleHistorical" fork="true">
			<classpath location="${jar.yokwe}" />
			<classpath refid="ext.jar" />
			<arg value="tmp/fetch/google-historical"/>
			<arg value="tmp/database/google-historical-update.csv"/>
		</java>
	</target>

       <target name="run-update-google-finance">
                <java classname="yokwe.finance.securities.update.GoogleFinance" fork="true">
                        <classpath location="${jar.yokwe}" />
                        <classpath refid="ext.jar" />
                        <arg value="tmp/fetch/google-finance"/>
                        <arg value="tmp/database/google-finance.csv"/>
                </java>
        </target>

</project>